import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { BehaviorSubject } from 'rxjs';
import axios from 'axios';

const MARKET_PRICE = {
  "status": "ok",
  "name": "Market Price (USD)",
  "unit": "USD",
  "period": "day",
  "description": "Average USD market price across major bitcoin exchanges.",
  "values": [
    {
      "x": 1590192000,
      "y": 9167.26
    },
    {
      "x": 1590278400,
      "y": 9178.32
    },
    {
      "x": 1590364800,
      "y": 8730.73
    },
    {
      "x": 1590451200,
      "y": 8899.66
    },
    {
      "x": 1590537600,
      "y": 8842.85
    },
    {
      "x": 1590624000,
      "y": 9197.54
    },
    {
      "x": 1590710400,
      "y": 9569.21
    },
    {
      "x": 1590796800,
      "y": 9425.98
    },
    {
      "x": 1590883200,
      "y": 9698.1
    },
    {
      "x": 1590969600,
      "y": 9450.84
    },
    {
      "x": 1591056000,
      "y": 10204.23
    },
    {
      "x": 1591142400,
      "y": 9525.57
    },
    {
      "x": 1591228800,
      "y": 9658.04
    },
    {
      "x": 1591315200,
      "y": 9794.56
    },
    {
      "x": 1591401600,
      "y": 9623.75
    },
    {
      "x": 1591488000,
      "y": 9670.43
    },
    {
      "x": 1591574400,
      "y": 9753.85
    },
    {
      "x": 1591660800,
      "y": 9782.59
    },
    {
      "x": 1591747200,
      "y": 9775.15
    },
    {
      "x": 1591833600,
      "y": 9892.13
    },
    {
      "x": 1591920000,
      "y": 9286.42
    },
    {
      "x": 1592006400,
      "y": 9459.97
    },
    {
      "x": 1592092800,
      "y": 9473.5
    },
    {
      "x": 1592179200,
      "y": 9330.07
    },
    {
      "x": 1592265600,
      "y": 9426.7
    },
    {
      "x": 1592352000,
      "y": 9526.0
    },
    {
      "x": 1592438400,
      "y": 9454.81
    },
    {
      "x": 1592524800,
      "y": 9380.03
    },
    {
      "x": 1592611200,
      "y": 9300.15
    },
    {
      "x": 1592697600,
      "y": 9357.43
    },
    {
      "x": 1592784000,
      "y": 9284.78
    },
    {
      "x": 1592870400,
      "y": 9691.9
    },
    {
      "x": 1592956800,
      "y": 9621.49
    },
    {
      "x": 1593043200,
      "y": 9276.58
    },
    {
      "x": 1593129600,
      "y": 9240.85
    },
    {
      "x": 1593216000,
      "y": 9154.45
    },
    {
      "x": 1593302400,
      "y": 9004.23
    },
    {
      "x": 1593388800,
      "y": 9127.47
    },
    {
      "x": 1593475200,
      "y": 9185.35
    },
    {
      "x": 1593561600,
      "y": 9133.97
    },
    {
      "x": 1593648000,
      "y": 9236.38
    },
    {
      "x": 1593734400,
      "y": 9087.98
    },
    {
      "x": 1593820800,
      "y": 9072.42
    },
    {
      "x": 1593907200,
      "y": 9131.31
    },
    {
      "x": 1593993600,
      "y": 9089.09
    },
    {
      "x": 1594080000,
      "y": 9348.91
    },
    {
      "x": 1594166400,
      "y": 9256.23
    },
    {
      "x": 1594252800,
      "y": 9440.07
    },
    {
      "x": 1594339200,
      "y": 9238.04
    },
    {
      "x": 1594425600,
      "y": 9287.4
    },
    {
      "x": 1594512000,
      "y": 9235.96
    },
    {
      "x": 1594598400,
      "y": 9295.9
    },
    {
      "x": 1594684800,
      "y": 9238.13
    },
    {
      "x": 1594771200,
      "y": 9254.52
    },
    {
      "x": 1594857600,
      "y": 9193.51
    },
    {
      "x": 1594944000,
      "y": 9131.0
    },
    {
      "x": 1595030400,
      "y": 9154.19
    },
    {
      "x": 1595116800,
      "y": 9174.71
    },
    {
      "x": 1595203200,
      "y": 9214.66
    },
    {
      "x": 1595289600,
      "y": 9163.87
    },
    {
      "x": 1595376000,
      "y": 9392.66
    },
    {
      "x": 1595462400,
      "y": 9537.4
    },
    {
      "x": 1595548800,
      "y": 9613.11
    },
    {
      "x": 1595635200,
      "y": 9551.28
    },
    {
      "x": 1595721600,
      "y": 9707.5
    },
    {
      "x": 1595808000,
      "y": 9938.83
    },
    {
      "x": 1595894400,
      "y": 11042.4
    },
    {
      "x": 1595980800,
      "y": 10934.94
    },
    {
      "x": 1596067200,
      "y": 11102.67
    },
    {
      "x": 1596153600,
      "y": 11114.93
    },
    {
      "x": 1596240000,
      "y": 11343.88
    },
    {
      "x": 1596326400,
      "y": 11823.69
    },
    {
      "x": 1596412800,
      "y": 11077.77
    },
    {
      "x": 1596499200,
      "y": 11242.57
    },
    {
      "x": 1596585600,
      "y": 11194.25
    },
    {
      "x": 1596672000,
      "y": 11750.28
    },
    {
      "x": 1596758400,
      "y": 11772.94
    },
    {
      "x": 1596844800,
      "y": 11605.6
    },
    {
      "x": 1596931200,
      "y": 11767.6
    },
    {
      "x": 1597017600,
      "y": 11684.06
    },
    {
      "x": 1597104000,
      "y": 11893.03
    },
    {
      "x": 1597190400,
      "y": 11392.43
    },
    {
      "x": 1597276800,
      "y": 11573.11
    },
    {
      "x": 1597363200,
      "y": 11777.43
    },
    {
      "x": 1597449600,
      "y": 11774.38
    },
    {
      "x": 1597536000,
      "y": 11873.98
    },
    {
      "x": 1597622400,
      "y": 11914.01
    },
    {
      "x": 1597708800,
      "y": 12293.72
    },
    {
      "x": 1597795200,
      "y": 11969.53
    },
    {
      "x": 1597881600,
      "y": 11734.0
    },
    {
      "x": 1597968000,
      "y": 11865.82
    },
    {
      "x": 1598054400,
      "y": 11522.8
    },
    {
      "x": 1598140800,
      "y": 11683.44
    },
    {
      "x": 1598227200,
      "y": 11653.02
    },
    {
      "x": 1598313600,
      "y": 11763.93
    },
    {
      "x": 1598400000,
      "y": 11337.4
    },
    {
      "x": 1598486400,
      "y": 11467.37
    },
    {
      "x": 1598572800,
      "y": 11302.01
    },
    {
      "x": 1598659200,
      "y": 11534.75
    },
    {
      "x": 1598745600,
      "y": 11481.64
    },
    {
      "x": 1598832000,
      "y": 11707.78
    },
    {
      "x": 1598918400,
      "y": 11659.57
    },
    {
      "x": 1599004800,
      "y": 11923.25
    },
    {
      "x": 1599091200,
      "y": 11397.44
    },
    {
      "x": 1599177600,
      "y": 10187.51
    },
    {
      "x": 1599264000,
      "y": 10467.89
    },
    {
      "x": 1599350400,
      "y": 10159.62
    },
    {
      "x": 1599436800,
      "y": 10254.93
    },
    {
      "x": 1599523200,
      "y": 10367.74
    },
    {
      "x": 1599609600,
      "y": 10121.52
    },
    {
      "x": 1599696000,
      "y": 10227.83
    },
    {
      "x": 1599782400,
      "y": 10352.66
    },
    {
      "x": 1599868800,
      "y": 10395.44
    },
    {
      "x": 1599955200,
      "y": 10446.44
    },
    {
      "x": 1600041600,
      "y": 10330.77
    },
    {
      "x": 1600128000,
      "y": 10674.64
    },
    {
      "x": 1600214400,
      "y": 10785.62
    },
    {
      "x": 1600300800,
      "y": 10948.43
    },
    {
      "x": 1600387200,
      "y": 10943.89
    },
    {
      "x": 1600473600,
      "y": 10931.79
    },
    {
      "x": 1600560000,
      "y": 11081.43
    },
    {
      "x": 1600646400,
      "y": 10919.65
    },
    {
      "x": 1600732800,
      "y": 10430.46
    },
    {
      "x": 1600819200,
      "y": 10532.22
    },
    {
      "x": 1600905600,
      "y": 10234.48
    },
    {
      "x": 1600992000,
      "y": 10732.43
    },
    {
      "x": 1601078400,
      "y": 10692.84
    },
    {
      "x": 1601164800,
      "y": 10732.4
    },
    {
      "x": 1601251200,
      "y": 10774.24
    },
    {
      "x": 1601337600,
      "y": 10692.33
    },
    {
      "x": 1601424000,
      "y": 10840.8
    },
    {
      "x": 1601510400,
      "y": 10777.92
    },
    {
      "x": 1601596800,
      "y": 10619.24
    },
    {
      "x": 1601683200,
      "y": 10575.06
    },
    {
      "x": 1601769600,
      "y": 10551.77
    },
    {
      "x": 1601856000,
      "y": 10673.46
    },
    {
      "x": 1601942400,
      "y": 10788.56
    },
    {
      "x": 1602028800,
      "y": 10603.74
    },
    {
      "x": 1602115200,
      "y": 10670.8
    },
    {
      "x": 1602201600,
      "y": 10923.3
    },
    {
      "x": 1602288000,
      "y": 11063.19
    },
    {
      "x": 1602374400,
      "y": 11302.67
    },
    {
      "x": 1602460800,
      "y": 11376.61
    },
    {
      "x": 1602547200,
      "y": 11540.04
    },
    {
      "x": 1602633600,
      "y": 11428.24
    },
    {
      "x": 1602720000,
      "y": 11431.32
    },
    {
      "x": 1602806400,
      "y": 11503.73
    },
    {
      "x": 1602892800,
      "y": 11327.57
    },
    {
      "x": 1602979200,
      "y": 11366.51
    },
    {
      "x": 1603065600,
      "y": 11508.2
    },
    {
      "x": 1603152000,
      "y": 11758.16
    }
  ]
}


@Injectable({
  providedIn: 'root'
})
export class BitcoinService {

  constructor(private http: HttpClient) { }


  private BASE_URL = 'https://blockchain.info/tobtc?currency=USD&value=1'

  private _pets$ = new BehaviorSubject<Number>(0);
  public pets$ = this._pets$.asObservable()

  public async getRate(): Promise<Number> {
    const res = await axios.get<Number>(this.BASE_URL)
    const currRate = res.data
    return currRate
    // .subscribe(res => {
    //   console.log(res);
    //   // this._pets$.next(res);
    // })
  }

  public getMarketPrice(): Promise<Object> {
    return Promise.resolve(MARKET_PRICE)
  }

}
